FROM n8nio/n8n:2.5.0-debian

USER root

# Debian-пакеты (ffmpeg, python, build tools)
RUN apt-get update && apt-get install -y \
  ffmpeg \
  python3 \
  python3-pip \
  git \
  curl \
  bash \
  build-essential \
  ca-certificates \
  apache2-utils \
  && rm -rf /var/lib/apt/lists/*

# npm-глобалки (КАК У ТЕБЯ БЫЛО, БЕЗ ЛОМАЮЩИХ 2.x)
RUN npm install -g \
  fs-extra \
  path \
  axios \
  node-fetch \
  form-data \
  moment \
  date-fns \
  lodash \
  csv-parser \
  xml2js \
  js-yaml \
  xlsx \
  jsonwebtoken \
  simple-oauth2 \
  uuid \
  openai \
  node-telegram-bot-api \
  vk-io \
  bcrypt \
  validator \
  joi \
  winston \
  dotenv \
  adm-zip \
  archiver \
  oauth-1.0a

USER node
