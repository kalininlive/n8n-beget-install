FROM n8nio/n8n:2.5.0

USER root

# === System dependencies ===
RUN apk add --no-cache \
  bash \
  curl \
  git \
  make \
  g++ \
  gcc \
  python3 \
  py3-pip \
  libffi-dev \
  ffmpeg \
  apache2-utils

# === Python tools (yt-dlp etc) ===
RUN pip3 install --no-cache-dir yt-dlp --break-system-packages

# === npm config ===
RUN npm config set fund false \
 && npm config set audit false

# === Node global libraries ===
RUN npm install -g \
  axios \
  node-fetch \
  form-data \
  moment \
  date-fns \
  lodash \
  fs-extra \
  csv-parser \
  xml2js \
  js-yaml \
  xlsx \
  jsonwebtoken \
  simple-oauth2 \
  uuid \
  openai \
  langchain \
  node-telegram-bot-api \
  fluent-ffmpeg \
  ffmpeg-static \
  oauth-1.0a

USER node
