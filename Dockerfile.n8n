# Dockerfile.n8n — кастомный образ n8n с доп. библиотеками
FROM docker.n8n.io/n8nio/n8n:latest

# Установка системных пакетов
RUN apk add --no-cache \
    python3 \
    py3-pip \
    ffmpeg \
    && python3 -m venv /venv

# Установка pip-библиотек
RUN /venv/bin/pip install --no-cache-dir \
    yt-dlp \
    openai \
    numpy \
    opencv-python-headless

# Установка npm-библиотек
RUN npm install -g \
    axios \
    node-fetch \
    form-data \
    moment \
    date-fns \
    lodash \
    fs-extra \
    path \
    csv-parser \
    xml2js \
    js-yaml \
    xlsx \
    jsonwebtoken \
    simple-oauth2 \
    uuid \
    openai \
    @tensorflow/tfjs-node \
    langchain \
    langchain-openai \
    node-telegram-bot-api \
    discord.js \
    vk-io \
    whatsapp-web.js \
    fluent-ffmpeg \
    ffmpeg-static \
    yt-dlp-exec \
    google-tts-api \
    @vitalets/google-translate-token \
    node-wav \
    lame \
    googleapis \
    @supabase/supabase-js \
    pg \
    mongoose \
    ioredis \
    bcrypt \
    validator \
    joi \
    winston \
    dotenv \
    prom-client \
    node-downloader-helper \
    adm-zip \
    archiver

# Добавление yt-dlp в PATH
RUN ln -s /venv/bin/yt-dlp /usr/local/bin/yt-dlp

# Завершение
CMD ["tini", "--", "/docker-entrypoint.sh"]
